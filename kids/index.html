<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PixelUp Kids – Favole IA (5 storie × 10 scene)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --pink:#ff7ecb; --blue:#6fb6ff; --text:#16223a; --muted:#51607a; --card:#fff;
  --radius:20px; --shadow:0 10px 30px rgba(20,20,60,.12);
}
*{box-sizing:border-box} html,body{margin:0}
body{
  font-family:Fredoka, Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--text);
  background:
    radial-gradient(900px 600px at 10% -10%, rgba(255,126,203,.35) 0, rgba(255,126,203,0) 60%),
    radial-gradient(900px 600px at 110% 10%, rgba(111,182,255,.35) 0, rgba(111,182,255,0) 60%),
    linear-gradient(135deg, #ffe7f7 0%, #eaf3ff 100%);
  min-height:100vh;
}
.container{max-width:1080px;margin:0 auto;padding:20px 18px 64px}
header{display:flex;align-items:center;gap:12px}
header img.logo{height:42px;border-radius:12px;box-shadow:var(--shadow)}
header .brand{font-weight:800;font-size:20px}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin-top:16px}
h1{font-size:clamp(26px,4.6vw,44px);margin:10px 0}
.subtitle{color:var(--muted)}
.controls{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin-top:10px}
.controls .col{grid-column:span 12}
@media(min-width:900px){.controls .col{grid-column:span 6}}
select,input,button{
  width:100%;border:2px solid #e8ecff;border-radius:14px;padding:12px 14px;font-size:16px;outline:none;
}
button{cursor:pointer;font-weight:800}
.primary{background:linear-gradient(135deg,var(--pink),var(--blue));border:0}
.viewer{display:none;margin-top:16px}
.toolbar{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px}
.pill{background:#fff;border:2px solid #e8ecff;border-radius:999px;padding:8px 12px;font-weight:700}
.art{width:100%;aspect-ratio:16/9;border-radius:18px;overflow:hidden;box-shadow:var(--shadow);background:#f3f4f6}
.art img{width:100%;height:100%;object-fit:cover;transform:scale(1.03);transition:transform 1.2s ease}
.art:hover img{transform:scale(1.06)}
#sceneTitle{margin:12px 0 4px}
#sceneText{font-size:18px;line-height:1.45}
.actions{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.badge{display:inline-flex;align-items:center;gap:8px}
audio{width:100%}
footer{margin-top:24px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
  <div class="container">
    <header>
      <img class="logo" src="logopixelup.png" alt="PixelUp" />
      <div class="brand">PixelUp Kids</div>
    </header>

    <section class="card">
      <h1>Favole Magiche – 5 storie × 10 scene</h1>
      <p class="subtitle">Scegli un personaggio, inserisci il nome e goditi 10 capitoli con immagini locali e voce dolce (mamma, papà, bimba o bimbo) tramite audio MP3.</p>

      <div class="controls">
        <div class="col">
          <label>Il tuo nome</label>
          <input id="kidName" type="text" placeholder="Es. Martina, Luca..." />
        </div>
        <div class="col">
          <label>Personaggio</label>
          <select id="character">
            <option value="drago">🐲 Drago</option>
            <option value="cavaliere">🛡️ Cavaliere</option>
            <option value="astronauta">🚀 Astronauta</option>
            <option value="fata">🧚‍♀️ Fata</option>
            <option value="cagnolino">🐶 Cagnolino</option>
          </select>
        </div>
        <div class="col">
          <label>Voce (server)</label>
          <select id="voiceServer">
            <option value="mamma">👩‍🍼 Mamma</option>
            <option value="papa">👨‍🍼 Papà</option>
            <option value="bimba">👧 Bimba</option>
            <option value="bimbo">👦 Bimbo</option>
          </select>
        </div>
        <div class="col">
          <label>Voce fallback (browser)</label>
          <select id="voicePreset">
            <option value="narratrice">Narratrice</option>
            <option value="narratore">Narratore</option>
            <option value="bimba">Bimba (cartoon)</option>
            <option value="bimbo">Bimbo (cartoon)</option>
          </select>
        </div>
        <div class="col" style="grid-column:span 12">
          <button id="btnStart" class="primary">🎉 Inizia la favola</button>
        </div>
      </div>
    </section>

    <section id="viewer" class="viewer card">
      <div class="toolbar">
        <span class="pill">👤 <b id="pillKid">Bimbo</b></span>
        <span class="pill">📚 <b id="pillStory">Drago</b></span>
        <span class="pill badge">🔊 <b id="pillVoice">Voce: Mamma</b></span>
      </div>

      <h2 id="sceneTitle">Titolo scena</h2>
      <div class="art"><img id="sceneImg" alt="Illustrazione scena"></div>
      <p id="sceneText">Testo scena…</p>
      <audio id="sceneAudio" controls></audio>

      <div class="actions">
        <button id="btnPrev">⬅️ Indietro</button>
        <button id="btnSpeak">🔊 Ascolta</button>
        <button id="btnNext" class="primary">Avanti ➡️</button>
      </div>
    </section>

    <footer>© PixelUp Kids · Immagini in <code>/kids/img/</code> · Audio in <code>/kids/audio/</code></footer>
  </div>

<script>
// ====== CONTENUTI (5 favole × 10 scene) ======
// Ogni scena punta a un'immagine locale PNG e a un audio MP3 (se disponibile).
// Percorso immagini: /kids/img/<slug>-<index>.png
// Percorso audio:   /kids/audio/<slug>-<index>.mp3  (voce dolce generata dal tuo backend)

const STORIES = {
  drago: {
    title: "Il viaggio del Drago Gentile",
    scenes: [
      {
        title: "Capitolo 1",
        text: "In una valle luminosa viveva un drago dalle scaglie cangianti, curioso e coraggioso.",
        image: "./img/drago-0.png",
        audio: "./audio/drago-0.mp3"
      },
      {
        title: "Capitolo 2",
        text: "Amava ascoltare il vento tra gli alberi e aiutare gli animali smarriti a ritrovare casa.",
        image: "./img/drago-1.png",
        audio: "./audio/drago-1.mp3"
      },
      {
        title: "Capitolo 3",
        text: "Un mattino ricevette un invito misterioso: una porta gentile attendeva chi scegliesse la bontà.",
        image: "./img/drago-2.png",
        audio: "./audio/drago-2.mp3"
      },
      {
        title: "Capitolo 4",
        text: "Con un respiro profondo, decise di mettersi in cammino verso la foresta incantata.",
        image: "./img/drago-3.png",
        audio: "./audio/drago-3.mp3"
      },
      {
        title: "Capitolo 5",
        text: "Sul sentiero s’intravedevano luci che sembravano parole, e ogni passo rendeva l’aria più dolce.",
        image: "./img/drago-4.png",
        audio: "./audio/drago-4.mp3"
      },
      {
        title: "Capitolo 6",
        text: "Vicino a un ruscello trovò altri viaggiatori, e il drago li accompagnò con storie di amicizia.",
        image: "./img/drago-5.png",
        audio: "./audio/drago-5.mp3"
      },
      {
        title: "Capitolo 7",
        text: "Quando il sole tramontò, il cielo si riempì di stelle che guidavano il suo cammino.",
        image: "./img/drago-6.png",
        audio: "./audio/drago-6.mp3"
      },
      {
        title: "Capitolo 8",
        text: "Un ponte di pietra apparve davanti a lui, e solo con coraggio e gentilezza poteva attraversarlo.",
        image: "./img/drago-7.png",
        audio: "./audio/drago-7.mp3"
      },
      {
        title: "Capitolo 9",
        text: "Dall’altra parte trovò un villaggio che lo accolse come un amico, non come un mostro.",
        image: "./img/drago-8.png",
        audio: "./audio/drago-8.mp3"
      },
      {
        title: "Capitolo 10",
        text: "E così il drago capì che la sua forza non era nel fuoco, ma nel cuore gentile che sapeva donare.",
        image: "./img/drago-9.png",
        audio: "./audio/drago-9.mp3"
      }
    ]
  }
};

  cavaliere: {
    title: "Il Cavaliere del Ponte di Luce",
    scenes: Array.from({length:10}).map((_,i)=>({
      title: `Capitolo ${i+1}`,
      text: [
        "Un giovane cavaliere sognava un regno di pace: la sua spada brillava solo quando difendeva i deboli.",
        "Il ponte di luce appariva a chi non cercava gloria, ma amicizia e lealtà.",
        "Davanti a lui, due strade: correre oltre le paure o fermarsi per aiutare un passero bagnato.",
        "Scelse la gentilezza, e il ponte diventò più luminoso, come un sorriso nel cielo.",
        "Ogni passo svelava un ricordo felice, e il cuore batteva al ritmo della speranza."
      ][i%5] + ` (${i+1}/10)`,
      image: `/kids/img/cavaliere-${i}.png`,
      audio: `/kids/audio/cavaliere-${i}.mp3`
    }))
  },
  astronauta: {
    title: "L’Astronauta delle Stelle Amiche",
    scenes: Array.from({length:10}).map((_,i)=>({
      title: `Capitolo ${i+1}`,
      text: [
        "Tra pianeti di zucchero filato e comete danzanti, l’astronauta cercava una costellazione nascosta.",
        "Il suo casco rifletteva stelle come lucciole, e il silenzio dello spazio sembrava una ninna nanna.",
        "Una sonda inviò un messaggio: chi condivide la luce trova sempre la rotta.",
        "Decise di aiutare una piccola navetta in panne: le stelle applaudirono con lampi gentili.",
        "La rotta segreta si accese, disegnando un sentiero verso un sogno da custodire."
      ][i%5] + ` (${i+1}/10)`,
      image: `/kids/img/astronauta-${i}.png`,
      audio: `/kids/audio/astronauta-${i}.mp3`
    }))
  },
  fata: {
    title: "La Fata e la Porta dei Ricordi Felici",
    scenes: Array.from({length:10}).map((_,i)=>({
      title: `Capitolo ${i+1}`,
      text: [
        "Nella radura dei petali cantanti, una fata custodiva il segreto della porta dei ricordi felici.",
        "Il suo volo lasciava scie di polvere di stelle e piccole risate di rugiada.",
        "Una bimba aveva perso un sogno; la fata decise di illuminarle la strada con una lanterna gentile.",
        "Ogni gesto cortese apriva una fessura di luce nella porta, come un cuore che si schiude.",
        "Quando la porta si aprì, l’aria profumò di biscotti alla cannella e abbracci sinceri."
      ][i%5] + ` (${i+1}/10)`,
      image: `/kids/img/fata-${i}.png`,
      audio: `/kids/audio/fata-${i}.mp3`
    }))
  },
  cagnolino: {
    title: "Il Cagnolino e il Sentiero dei Sorrisi",
    scenes: Array.from({length:10}).map((_,i)=>({
      title: `Capitolo ${i+1}`,
      text: [
        "Un cagnolino dal naso curioso trovava sempre amici dove gli altri vedevano ostacoli.",
        "Seguiva tracce di risate e riportava a casa palline di sole cadute tra i fiori.",
        "Un giorno scoprì un sentiero di impronte a forma di cuore: conduceva a un piccolo mistero.",
        "Divise il suo biscottino con un riccio timido, e il bosco applaudì frusciando piano.",
        "Alla fine del sentiero, c’era un premio: un abbraccio che scaldava più del sole."
      ][i%5] + ` (${i+1}/10)`,
      image: `/kids/img/cagnolino-${i}.png`,
      audio: `/kids/audio/cagnolino-${i}.mp3`
    }))
  }
};

// ====== STATO ======
let current = 0;
let activeKey = "drago";
let kidName = "Amico";
let voiceServer = "mamma"; // mamma | papa | bimba | bimbo

// ====== UI ELEMENTS ======
const $ = s => document.querySelector(s);
const sceneTitle = $('#sceneTitle');
const sceneText  = $('#sceneText');
const sceneImg   = $('#sceneImg');
const sceneAudio = $('#sceneAudio');

// ====== AVVIO ======
$('#btnStart').addEventListener('click', ()=>{
  kidName = $('#kidName').value.trim() || "Amico";
  activeKey = $('#character').value;
  voiceServer = $('#voiceServer').value;

  $('#pillKid').textContent = kidName;
  $('#pillStory').textContent = STORIES[activeKey].title;
  $('#pillVoice').textContent = `Voce: ${voiceServer.charAt(0).toUpperCase()+voiceServer.slice(1)}`;

  current = 0;
  render();
  $('#viewer').style.display = 'block';
  window.scrollTo({top:0, behavior:'smooth'});
});

// ====== RENDER SCENA ======
function render(){
  const story = STORIES[activeKey];
  const s = story.scenes[current];

  sceneTitle.textContent = s.title;
  // Personalizza leggermente il testo con il nome
  sceneText.textContent  = s.text.replaceAll(" bimba ", ` ${kidName} `).replaceAll(" bimbo ", ` ${kidName} `);
  sceneImg.src = s.image;
  // Audio server: se presente, lo usa; altrimenti lascia vuoto (fallback TTS su click Ascolta)
  sceneAudio.src = s.audio || "";
  sceneAudio.onerror = ()=> { sceneAudio.removeAttribute('src'); }; // se manca il file, non bloccare
}

// ====== NAVIGAZIONE ======
$('#btnNext').addEventListener('click', ()=>{
  const arr = STORIES[activeKey].scenes;
  if(current < arr.length-1){ current++; render(); }
});
$('#btnPrev').addEventListener('click', ()=>{
  if(current > 0){ current--; render(); }
});

// ====== ASCOLTO: audio server → fallback TTS browser ======
$('#btnSpeak').addEventListener('click', ()=>{
  if(sceneAudio && sceneAudio.src){
    sceneAudio.play().catch(()=> fallbackSpeak());
  } else {
    fallbackSpeak();
  }
});

// Fallback TTS (browser) con preset cartoon
let voices = [];
if('speechSynthesis' in window){
  const load = ()=> voices = window.speechSynthesis.getVoices() || [];
  load(); window.speechSynthesis.onvoiceschanged = load;
}
function pickItalianVoice(pref="f"){
  if(!voices.length) return null;
  const it = voices.filter(v=> (v.lang||"").toLowerCase().startsWith('it'));
  if(!it.length) return voices[0];
  const fem = it.find(v=> /fem|silvia|elena|sofia|lucia|female/i.test(v.name));
  const mas = it.find(v=> /mas|luca|marco|paolo|giorgio|male/i.test(v.name));
  if(pref==="f" && fem) return fem;
  if(pref==="m" && mas) return mas;
  return it[0];
}
function fallbackSpeak(){
  if(!('speechSynthesis' in window)) { alert('Audio non disponibile.'); return; }
  const preset = $('#voicePreset').value || 'narratrice';
  const u = new SpeechSynthesisUtterance(sceneText.textContent);
  u.lang = 'it-IT';
  let pref = (preset==='narratore' || preset==='bimbo') ? 'm' : 'f';
  u.voice = pickItalianVoice(pref);
  if(preset==='bimba'){ u.pitch = 1.35; u.rate = 1.02; }
  else if(preset==='bimbo'){ u.pitch = 1.15; u.rate = 1.05; }
  else if(preset==='narratrice'){ u.pitch = 1.08; u.rate = 0.98; }
  else { u.pitch = 0.96; u.rate = 0.98; }
  window.speechSynthesis.cancel();
  setTimeout(()=> window.speechSynthesis.speak(u), 120);
}
</script>
</body>
</html>
